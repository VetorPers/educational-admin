var e=Object.defineProperty,a=Object.defineProperties,t=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,s=(a,t,l)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):a[t]=l;import{E as i,u as n,A as u,b as d,r as c,M as p,o as g,c as m,w as f,h as v,m as h,p as b,v as _,g as y,W as w,_ as k,e as D,l as x,k as C,q as M}from"./vendor.7a5fefe5.js";import{g as O,d as z}from"./index.425550fe.js";let V="/api/officialWebsite";const Y=e=>i({url:V+"/addHonor",method:"post",data:e}),j=e=>i({url:V+"/updateHonor",method:"post",data:e});const H=["src"],P={key:1,class:"el-icon-plus avatar-uploader-icon"},S={class:"dialog-footer"},$={__name:"editHonor",props:{nowData:{type:Object,default:{}},dialogVisible:Boolean},emits:["close"],setup(e,{emit:a}){const t=e,l=n(),o=u(O({name:"token"})),r=u(!1),s=u(null),i=t.nowData.id?d(z(t.nowData)):d({date:"",desc:"",image_url:"",type:2,device:2}),D=()=>{s.value.validate().then((()=>{r.value=!0;const e=i.id?j:Y;i.date=(e=>{const a=new Date(e),t=a.getFullYear(),l=a.getMonth()<9?"0"+(a.getMonth()+1):a.getMonth()+1,o=a.getDate()<10?"0"+a.getDate():a.getDate();return a.getHours(),a.getMinutes(),a.getSeconds(),`${t}-${l}-${o}`})(i.date),e(i).then((e=>{k.success("提交成功"),r.value=!1,V("success")})).catch((()=>{k.error("提交失败"),r.value=!1}))})).catch((e=>{}))},x=(e,a)=>{i.image_url=e.data.url,k.success("上传成功！")},C=(e,a,t)=>{if(e.message&&401==JSON.parse(e.message).code)return k.warning("登录已过期，请重新登录"),void l.push("/login");k.error("上传失败")},M=()=>{V("")},V=e=>{a("close",e)};return(a,t)=>{const l=c("el-date-picker"),n=c("el-form-item"),u=c("el-input"),d=c("el-upload"),k=c("el-form"),O=c("el-button"),z=c("el-dialog"),Y=p("loading");return g(),m(z,{title:w(i).id?"修改获奖荣誉":"添加获奖荣誉","model-value":e.dialogVisible,onClose:M,"close-on-click-modal":!1,"close-on-press-escape":!1},{footer:f((()=>[v("span",S,[h(O,{onClick:t[2]||(t[2]=e=>V("")),size:"small"},{default:f((()=>[b("取 消")])),_:1}),h(O,{type:"primary",onClick:D,size:"small"},{default:f((()=>[b("确 定")])),_:1})])])),default:f((()=>[_((g(),y("div",null,[h(k,{ref_key:"formRef",ref:s,model:w(i),"label-width":"100px"},{default:f((()=>[h(n,{prop:"date",label:"活动日期:",rules:[{required:!0,message:"输入活动日期",trigger:"blur"}]},{default:f((()=>[h(l,{modelValue:w(i).date,"onUpdate:modelValue":t[0]||(t[0]=e=>w(i).date=e),type:"date",size:"mini",placeholder:"请选择活动日期",style:{width:"100%"},format:"YYYY-MM-DD","value-format":"YYYY-MM-DD"},null,8,["modelValue"])])),_:1}),h(n,{prop:"desc",label:"描述:",rules:[{required:!0,message:"输入描述",trigger:"blur"}]},{default:f((()=>[h(u,{type:"text",size:"mini",modelValue:w(i).desc,"onUpdate:modelValue":t[1]||(t[1]=e=>w(i).desc=e),placeholder:"输入描述"},null,8,["modelValue"])])),_:1}),h(n,{label:"图片:",prop:"image_url",rules:[{required:!0,message:"选择图片"}]},{default:f((()=>[h(d,{class:"avatar-uploader",action:"/api/base/upload/","show-file-list":!1,"on-success":x,"on-error":C,limit:1,headers:{token:o.value,path:"/public/web_image/"}},{default:f((()=>[w(i).image_url?(g(),y("img",{key:0,style:{width:"100%",height:"100%"},src:w(i).image_url,class:"avatar"},null,8,H)):(g(),y("i",P))])),_:1},8,["headers"])])),_:1})])),_:1},8,["model"])])),[[Y,r.value]])])),_:1},8,["title","model-value"])}},__scopeId:"data-v-7a97324e"};const q={class:"btn-wrap g-flex-end"},B={class:"footer-wrap g-flex-end"},E={__name:"index",setup(e){const n=u(!1),w=u([]),O=d({total:0,size:10,current:1}),z=u(!1),Y=u({});D((()=>{j()}));const j=()=>{n.value=!0;const e=(u=((e,a)=>{for(var t in a||(a={}))o.call(a,t)&&s(e,t,a[t]);if(l)for(var t of l(a))r.call(a,t)&&s(e,t,a[t]);return e})({},O),a(u,t({type:2})));var u,d;(d=e,i({url:V+"/honorList",method:"get",params:d})).then((e=>{w.value=e.data.data,O.total=e.data.total})).catch((e=>{k.error(e.msg)})).finally((()=>{n.value=!1}))},H=()=>{Y.value={},z.value=!0},P=e=>{M.confirm("确认删除？","",{confirmButtonText:"确定",cancelButtonText:"取消",closeOnClickModal:!1,closeOnPressEscape:!1}).then((()=>{n.value=!0,(e=>i({url:V+"/deleteHonor",method:"post",data:{id:e}}))(e).then((e=>{k.success("删除成功"),j()})).catch((e=>{k.error("删除失败"),n.value=!1}))}))},S=e=>{z.value=!1,"success"===e&&j()},E=e=>{O.size=e,O.current=1,j()},I=e=>{O.current=e,j()},F=e=>{const a=new Date(e),t=a.getFullYear(),l=a.getMonth()<9?"0"+(a.getMonth()+1):a.getMonth()+1;return a.getDate(),a.getDate(),a.getHours(),a.getMinutes(),a.getSeconds(),`${t}年${l}月`};return(e,a)=>{const t=c("el-button"),l=c("el-empty"),o=c("el-table-column"),r=c("el-image"),s=c("el-table"),i=c("el-pagination"),u=p("loading");return g(),y("div",null,[v("div",q,[h(t,{size:"small",onClick:j},{default:f((()=>[b("刷 新")])),_:1}),h(t,{type:"primary",size:"small",onClick:H},{default:f((()=>[b("添 加")])),_:1})]),_((g(),m(s,{data:w.value,border:"",style:{width:"100%"}},{empty:f((()=>[h(l,{description:"暂无数据"})])),default:f((()=>[h(o,{prop:"date",label:"活动日期"},{default:f((e=>[b(C(F(e.row.date)),1)])),_:1}),b("> "),h(o,{prop:"desc",label:"描述","min-width":"200px"}),h(o,{prop:"image_url",label:"图片"},{default:f((e=>[h(r,{style:{width:"200px",height:"163px"},src:e.row.image_url,"preview-src-list":[e.row.image_url],fit:"cover"},null,8,["src","preview-src-list"])])),_:1}),h(o,{label:"操作"},{default:f((e=>[h(t,{type:"text",onClick:a=>{return t=e.row,Y.value=t,void(z.value=!0);var t}},{default:f((()=>[b("修 改")])),_:2},1032,["onClick"]),h(t,{type:"text",onClick:a=>P(e.row.id)},{default:f((()=>[b("删 除")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])),[[u,n.value]]),v("div",B,[h(i,{layout:"prev, pager, next",total:O.total,"current-page":O.current,"page-size":O.size,onSizeChange:E,onCurrentChange:I},null,8,["total","current-page","page-size"])]),z.value?(g(),m($,{key:0,nowData:Y.value,dialogVisible:z.value,onClose:S},null,8,["nowData","dialogVisible"])):x("",!0)])}},__scopeId:"data-v-5ac9218b"};export{E as default};
