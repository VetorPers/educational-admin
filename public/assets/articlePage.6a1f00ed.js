var e=Object.defineProperty,t=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,i=(t,a,l)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:l}):t[a]=l,o=(e,o)=>{for(var r in o||(o={}))a.call(o,r)&&i(e,r,o[r]);if(t)for(var r of t(o))l.call(o,r)&&i(e,r,o[r]);return e};import{Q as r}from"./vue-quill.esm-bundler.1cb9a179.js";import{I as s,u as n}from"./base.ef629649.js";/* empty css                       */import{_ as m,b as u,A as c,e as d,f as g,t as p,r as f,o as b,g as h,m as v,w as _,h as y,p as j,F as C,i as k,j as O,q as D,M as I,v as w,c as x,l as z}from"./vendor.7a5fefe5.js";import{f as S,g as V,h as L,i as q}from"./information.1d6cc0e7.js";import"./quill.119a8efe.js";import"./index.425550fe.js";const E={name:"EditNews",components:{QuillEditor:r,ElMessage:m},props:{dialogVisible:{type:Boolean,default:!1},formObj:{type:Object}},setup(e,t){const a=u({modules:{name:"imageUploader",module:s,options:{upload:function(e){return new Promise(((t,l)=>{n(e).then((e=>{a.titleImgList.push({checked:0,imgUrl:e.data.data.url}),1==a.titleImgList.length&&(a.titleImgList[0].checked=1,a.formData.title_img=a.titleImgList[0].imgUrl),t(e.data.data.url)})).catch((e=>{l(e)}))}))}}},toolbar:[["bold","italic","underline","strike"],[{header:1},{header:2}],[{list:"ordered"},{list:"bullet"}],[{size:["small",!1,"large","huge"]}],[{color:[]},{background:[]}],[{align:[]}],["image"]],formData:e.formObj||{title:"",author:"",article_time:"",article_detail:"",title_img:""},titleImgList:[],rules:{title:[{required:!0,message:"标题不能为空",trigger:"blur"}],author:[{required:!0,message:"作者不能为空",trigger:"blur"}],article_time:[{required:!0,message:"日期不能为空",trigger:"blur"}]}}),l=c(!1),i=c(null),r=c(null);d((()=>{a.formData.id&&(a.titleImgList=JSON.parse(a.formData.title_img_list))})),g((()=>{}));const f=p(a);return o({close:()=>{t.emit("close",!1)},checkTitleImg:e=>{a.titleImgList.forEach((e=>{e.checked=0})),a.titleImgList[e].checked=1,a.formData.title_img=a.titleImgList[e].imgUrl},quill:r,formRef:i,commitForm:()=>{i.value.validate().then((()=>{r.value.getContents()?a.formData.title_img?(a.formData.article_detail=r.value.getContents(),a.formData.title_img_list=JSON.stringify(a.titleImgList),l.value=!0,a.formData.id?S(a.formData).then((e=>{m.success("提交成功"),t.emit("saveSuccess")})).catch((e=>{m.error("提交失败")})).finally((()=>{l.value=!1})):V(a.formData).then((e=>{m.success("提交成功"),t.emit("saveSuccess")})).catch((e=>{m.error("提交失败")})).finally((()=>{l.value=!1}))):m.info("请上传图片作为标题图片"):m.info("文章详情不能为空")})).catch((()=>{}))}},f)}},U={class:"g-flex-start"},N=["onClick"],J=["src"],M={class:"dialog-footer"};E.render=function(e,t,a,l,i,o){const r=f("el-input"),s=f("el-form-item"),n=f("el-date-picker"),m=f("QuillEditor"),u=f("el-form"),c=f("el-button"),d=f("el-dialog");return b(),h("div",null,[v(d,{"model-value":a.dialogVisible,"before-close":l.close},{footer:_((()=>[y("span",M,[v(c,{onClick:l.close,size:"small"},{default:_((()=>[j("取 消")])),_:1},8,["onClick"]),v(c,{type:"primary",onClick:l.commitForm,size:"small"},{default:_((()=>[j("确 定")])),_:1},8,["onClick"])])])),default:_((()=>[v(u,{model:e.formData,rules:e.rules,ref:"formRef"},{default:_((()=>[v(s,{label:"标题",prop:"title"},{default:_((()=>[v(r,{style:{width:"400px"},size:"mini",modelValue:e.formData.title,"onUpdate:modelValue":t[0]||(t[0]=t=>e.formData.title=t)},null,8,["modelValue"])])),_:1}),v(s,{label:"作者",prop:"author"},{default:_((()=>[v(r,{style:{width:"400px"},size:"mini",modelValue:e.formData.author,"onUpdate:modelValue":t[1]||(t[1]=t=>e.formData.author=t)},null,8,["modelValue"])])),_:1}),v(s,{label:"日期",prop:"article_time"},{default:_((()=>[v(n,{style:{width:"400px"},size:"mini",modelValue:e.formData.article_time,"onUpdate:modelValue":t[2]||(t[2]=t=>e.formData.article_time=t),type:"date",placeholder:"选择日期","value-format":"YYYY-MM-DD"},null,8,["modelValue"])])),_:1}),v(s,{prop:"title_img",label:"标题图片:"},{default:_((()=>[y("div",U,[(b(!0),h(C,null,k(e.titleImgList,((e,t)=>(b(),h("div",{class:O(["title-img-wrap",e.checked?"checked-img":null]),key:t,onClick:e=>l.checkTitleImg(t)},[y("img",{style:{width:"100%",height:"100%"},src:e.imgUrl,alt:""},null,8,J)],10,N)))),128))])])),_:1}),v(s,{prop:"article_detail"},{default:_((()=>[v(m,{ref:"quill",style:{"min-height":"300px","max-height":"300px"},theme:"snow",contentType:"html",content:e.formData.article_detail,toolbar:e.toolbar,modules:e.modules},null,8,["content","toolbar","modules"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["model-value","before-close"])])},E.__scopeId="data-v-09e2351e";const P={name:"",props:{},components:{EditArticle:E},setup(e,t){const a=u({targetObj:null,tableData:[],paginationObj:{total:0,current:1,size:10}}),l=c(!1),i=c(!1),r=()=>{i.value=!0,L(a.paginationObj).then((e=>{a.tableData=e.data.data,a.paginationObj.total=e.data.total})).catch((e=>{m.error(e.msg)})).finally((()=>{i.value=!1}))};d((()=>{r()})),g((()=>{}));const s=p(a);return o({pageSizeChange:e=>{a.paginationObj.size=e,a.paginationObj.current=1,r()},pageCurrentChange:e=>{a.paginationObj.current=e,r()},getList:r,addItem:()=>{a.targetObj=null,l.value=!0},updateItem:e=>{a.targetObj=JSON.parse(JSON.stringify(e)),l.value=!0},deleteItem:e=>{D.confirm("确认删除？").then((()=>{i.value=!0,q(e).then((e=>{m.success("删除成功"),r()})).catch((e=>{m.error("删除失败"),i.value=!1}))}))},saveSuccess:()=>{l.value=!1,r()},loading:i,dialogVisible:l},s)}},Y={class:"btn-wrap g-flex-end"},A=["src"],F={class:"footer-wrap g-flex-end"};P.render=function(e,t,a,l,i,o){const r=f("el-button"),s=f("el-empty"),n=f("el-table-column"),m=f("el-table"),u=f("el-pagination"),c=f("EditArticle"),d=I("loading");return b(),h("div",null,[y("div",Y,[v(r,{size:"small",onClick:l.getList},{default:_((()=>[j("刷 新")])),_:1},8,["onClick"]),v(r,{type:"primary",size:"small",onClick:l.addItem},{default:_((()=>[j("添 加")])),_:1},8,["onClick"])]),y("div",null,[w((b(),x(m,{data:e.tableData,border:"",style:{width:"100%"}},{empty:_((()=>[v(s,{description:"暂无数据"})])),default:_((()=>[v(n,{prop:"title",label:"资讯标题"}),v(n,{prop:"url",label:"标题配图"},{default:_((t=>[e.tableData.length&&t.row.title_img?(b(),h("img",{key:0,style:{"max-width":"120px","max-height":"70px"},src:t.row.title_img,alt:""},null,8,A)):z("",!0)])),_:1}),v(n,{label:"操作"},{default:_((e=>[v(r,{type:"text",onClick:t=>l.updateItem(e.row)},{default:_((()=>[j("修 改")])),_:2},1032,["onClick"]),v(r,{type:"text",onClick:t=>l.deleteItem(e.row.id)},{default:_((()=>[j("删 除")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])),[[d,l.loading]]),y("div",F,[v(u,{layout:"total, prev, pager, next",total:e.paginationObj.total,"current-page":e.paginationObj.current,"page-size":e.paginationObj.size,onSizeChange:l.pageSizeChange,onCurrentChange:l.pageCurrentChange},null,8,["total","current-page","page-size","onSizeChange","onCurrentChange"])])]),l.dialogVisible?(b(),x(c,{key:0,dialogVisible:l.dialogVisible,formObj:e.targetObj,onClose:t[0]||(t[0]=e=>l.dialogVisible=!1),onSaveSuccess:l.saveSuccess},null,8,["dialogVisible","formObj","onSaveSuccess"])):z("",!0)])},P.__scopeId="data-v-4aba805a";export{P as default};
