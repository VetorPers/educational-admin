var e=Object.defineProperty,a=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,t=Object.prototype.propertyIsEnumerable,r=(a,l,t)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[l]=t,o=(e,o)=>{for(var n in o||(o={}))l.call(o,n)&&r(e,n,o[n]);if(a)for(var n of a(o))t.call(o,n)&&r(e,n,o[n]);return e};import{g as n}from"./index.425550fe.js";import{E as s,_ as i,u,a as d,A as p,d as c,b as m,e as b,f,t as g,r as v,M as h,o as _,c as y,w as k,h as j,m as O,p as C,v as D,g as w,F as S,i as V,y as z,z as x,q as B,l as L,k as E}from"./vendor.7a5fefe5.js";const I={name:"",props:{dialogVisible:{type:Boolean,required:!0,defalut:!1},formObj:{type:Object}},components:{ElMessage:i},emits:["close","saveSuccess"],setup(e,a){const l=u(),t=d(),r=p(!1),v=c((()=>t.state.init.phoneAppRouter)),h=m({formData:e.formObj||{url:"",link:"",enable_state:1,banner_order:1},fileList:[],rules:{url:[{required:!0,message:"图片地址不能为空"}],banner_order:[{required:!0,message:"排序不能为空",trigger:"blur"}]}}),_=p(n({name:"token"})),y=p(null);b((()=>{})),f((()=>{}));const k=g(h);return o({appRouteList:v,formRef:y,commitForm:()=>{y.value.validate().then((()=>{r.value=!0,h.formData.id?(e=>s({url:"/api/banner/updateBanner",method:"post",data:e}))(h.formData).then((e=>{i.success("提交成功"),a.emit("saveSuccess")})).catch((e=>{i.error("提交失败")})).finally((()=>{r.value=!1})):(e=>s({url:"/api/banner/addBanner",method:"post",data:e}))(h.formData).then((e=>{i.success("提交成功"),a.emit("saveSuccess")})).catch((e=>{i.error("提交失败")})).finally((()=>{r.value=!1}))})).catch((()=>{}))},beforeUpload:e=>{const{type:a,size:l}=e;return"image/png"!==a&&"image/jpeg"!==a?(i.warning("只能上传png或jpg格式图片！"),!1):!(l>2097152)||(i.warning("图片大小不能超过2M！"),!1)},removeImg:(e,a)=>{h.fileList=[],h.formData.url=""},close:()=>{a.emit("close",!1)},loading:r,uploadError:(e,a,t)=>{if(e.message&&401==JSON.parse(e.message).code)return i.warning("登录已过期，请重新登录"),void l.push("/login");i.error("上传失败")},token:_,handleAvatarSuccess:(e,a)=>{h.formData.url=e.data.url,i.success("上传成功！")}},k)}},R=["src"],U={key:1,class:"el-icon-plus avatar-uploader-icon"},A=(e=>(z("data-v-3e657657"),e=e(),x(),e))((()=>j("div",{class:"g-tips-text"},"* jpg/png格式；大小限制为2M；宽高比750:457，可视高度为440",-1))),M={class:"dialog-footer"};I.render=function(e,a,l,t,r,o){const n=v("el-upload"),s=v("el-form-item"),i=v("el-input"),u=v("el-option"),d=v("el-select"),p=v("el-switch"),c=v("el-form"),m=v("el-button"),b=v("el-dialog"),f=h("loading");return _(),y(b,{title:e.formData.id?"修改banner":"添加banner","model-value":l.dialogVisible,"before-close":t.close},{footer:k((()=>[j("span",M,[O(m,{onClick:t.close,size:"small"},{default:k((()=>[C("取 消")])),_:1},8,["onClick"]),O(m,{type:"primary",onClick:t.commitForm,size:"small"},{default:k((()=>[C("确 定")])),_:1},8,["onClick"])])])),default:k((()=>[D((_(),w("div",null,[O(c,{ref:"formRef",model:e.formData,rules:e.rules,"label-width":"120px"},{default:k((()=>[O(s,null,{default:k((()=>[O(n,{class:"avatar-uploader",action:"/api/base/upload/","show-file-list":!1,"on-success":t.handleAvatarSuccess,"before-upload":t.beforeUpload,"on-error":t.uploadError,"on-remove":t.removeImg,"file-list":e.fileList,limit:1,headers:{token:t.token}},{default:k((()=>[e.formData.url?(_(),w("img",{key:0,style:{width:"100%",height:"100%"},src:e.formData.url,class:"avatar"},null,8,R)):(_(),w("i",U))])),_:1},8,["on-success","before-upload","on-error","on-remove","file-list","headers"]),A])),_:1}),O(s,{prop:"url",label:"图片地址:"},{default:k((()=>[O(i,{size:"mini",disabled:!0,modelValue:e.formData.url,"onUpdate:modelValue":a[0]||(a[0]=a=>e.formData.url=a)},null,8,["modelValue"])])),_:1}),O(s,{prop:"banner_order",label:"排序:"},{default:k((()=>[O(i,{type:"number",size:"mini",modelValue:e.formData.banner_order,"onUpdate:modelValue":a[1]||(a[1]=a=>e.formData.banner_order=a),placeholder:"输入顺序"},null,8,["modelValue"])])),_:1}),O(s,{prop:"link",label:"跳转地址:"},{default:k((()=>[O(d,{size:"mini",placeholder:"点击banner跳转的地址",modelValue:e.formData.link,"onUpdate:modelValue":a[2]||(a[2]=a=>e.formData.link=a)},{default:k((()=>[(_(!0),w(S,null,V(t.appRouteList,((e,a)=>(_(),y(u,{key:a,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),O(s,{prop:"enable_state",label:"启用状态:"},{default:k((()=>[O(p,{modelValue:e.formData.enable_state,"onUpdate:modelValue":a[3]||(a[3]=a=>e.formData.enable_state=a),"active-value":1,"inactive-value":0},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),[[f,t.loading]])])),_:1},8,["title","model-value","before-close"])},I.__scopeId="data-v-3e657657";const q={name:"bannerIndex",props:{},components:{EditBanner:I,ElMessage:i},setup(e,a){const l=m({targetObj:null,tableData:[],paginationObj:{current:1,size:10,total:0}}),t=d(),r=c((()=>t.state.init.phoneAppRouter)),n=p(!1),u=p(!1);function v(e){u.value=e}const h=()=>{var e;n.value=!0,(e=l.paginationObj,s({url:"/api/banner/bannerList",method:"get",params:e})).then((e=>{l.tableData=e.data.data,l.paginationObj.total=e.data.total})).catch((e=>{i.error(e.msg)})).finally((()=>{n.value=!1}))};b((()=>{h()})),f((()=>{}));const _=g(l);return o({pageSizeChange:e=>{l.paginationObj.size=e,l.paginationObj.current=1,h()},pageCurrentChange:e=>{l.paginationObj.current=e,h()},changeDiaStatus:v,getList:h,saveSuccess:()=>{u.value=!1,h()},addBanner:()=>{l.targetObj=null,v(!0)},updateBanner:e=>{l.targetObj=JSON.parse(JSON.stringify(e)),v(!0)},deleteItem:e=>{B.confirm("确认删除？").then((()=>{n.value=!0,(e=>s({url:"/api/banner/deleteBanner",method:"post",data:{id:e}}))(e).then((e=>{i.success("删除成功"),h()})).catch((e=>{i.error("删除失败"),n.value=!1}))}))},appRouteList:r,loading:n,dialogVisible:u},_)}},F={class:"btn-wrap g-flex-end"},J=["src"],N={class:"footer-wrap g-flex-end"};q.render=function(e,a,l,t,r,o){const n=v("el-button"),s=v("el-empty"),i=v("el-table-column"),u=v("el-table"),d=v("el-pagination"),p=v("EditBanner"),c=h("loading");return _(),w("div",null,[j("div",F,[O(n,{size:"small",onClick:t.getList},{default:k((()=>[C("刷 新")])),_:1},8,["onClick"]),O(n,{type:"primary",size:"small",onClick:t.addBanner},{default:k((()=>[C("添 加")])),_:1},8,["onClick"])]),D((_(),y(u,{data:e.tableData,border:"",style:{width:"100%"}},{empty:k((()=>[O(s,{description:"暂无数据"})])),default:k((()=>[O(i,{prop:"url",label:"banner图"},{default:k((a=>[e.tableData.length&&a.row.url?(_(),w("img",{key:0,style:{"max-width":"120px","max-height":"70px"},src:a.row.url,alt:""},null,8,J)):L("",!0)])),_:1}),O(i,{prop:"link",label:"链接地址"},{default:k((e=>[C(E(e.row.link?t.appRouteList.find((a=>a.value==e.row.link)).label:""),1)])),_:1}),O(i,{prop:"enable_state",label:"启用状态"},{default:k((e=>[j("div",null,E(e.row.enable_state?"启用":"停用"),1)])),_:1}),O(i,{prop:"banner_order",label:"排序"}),O(i,{label:"操作"},{default:k((e=>[O(n,{type:"text",onClick:a=>t.updateBanner(e.row)},{default:k((()=>[C("修 改")])),_:2},1032,["onClick"]),O(n,{type:"text",onClick:a=>t.deleteItem(e.row.id)},{default:k((()=>[C("删 除")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])),[[c,t.loading]]),j("div",N,[O(d,{layout:"prev, pager, next",total:e.paginationObj.total,"current-page":e.paginationObj.current,"page-size":e.paginationObj.size,onSizeChange:t.pageSizeChange,onCurrentChange:t.pageCurrentChange},null,8,["total","current-page","page-size","onSizeChange","onCurrentChange"])]),t.dialogVisible?(_(),y(p,{key:0,dialogVisible:t.dialogVisible,formObj:e.targetObj,onClose:t.changeDiaStatus,onSaveSuccess:t.saveSuccess},null,8,["dialogVisible","formObj","onClose","onSaveSuccess"])):L("",!0)])},q.__scopeId="data-v-a68bc828";export{q as default};
