var e=Object.defineProperty,a=Object.defineProperties,t=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,r=(a,t,l)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):a[t]=l,s=(e,a)=>{for(var t in a||(a={}))o.call(a,t)&&r(e,t,a[t]);if(l)for(var t of l(a))i.call(a,t)&&r(e,t,a[t]);return e};import{Q as n}from"./vue-quill.esm-bundler.2661bb61.js";import{I as u,u as d}from"./base.8c6305d8.js";import{D as m,a as c,y as p,d as g,O as f,e as b,t as h,r as _,o as v,f as w,p as y,q as O,g as D,M as j,F as C,h as k,P as V,i as x,_ as I,L as z,w as S,c as L,k as E,j as N}from"./vendor.456c50f4.js";import{u as U,a as q,n as M,d as P}from"./information.10e4104d.js";import{h as R,a as F}from"./handleFunc.6f2e466b.js";import"./quill.8d3b73ad.js";import"./index.8c27f3b6.js";const J={name:"EditNews",components:{QuillEditor:n,ElMessage:m},props:{dialogVisible:{type:Boolean,default:!1},formObj:{type:Object}},setup(e,l){const o=c({modules:{name:"imageUploader",module:u,options:{upload:function(e){return new Promise(((a,t)=>{d(e).then((e=>{o.titleImgList.push({checked:0,imgUrl:e.data.data.url}),1==o.titleImgList.length&&(o.titleImgList[0].checked=1,o.formData.title_img=o.titleImgList[0].imgUrl),a(e.data.data.url)})).catch((e=>{t(e)}))}))}},clipboard:{matchVisual:!1}},toolbar:[["bold","italic","underline","strike"],[{header:1},{header:2}],[{list:"ordered"},{list:"bullet"}],[{size:["small",!1,"large","huge"]}],[{color:[]},{background:[]}],[{align:[]}],["image"]],formData:e.formObj||{title:"",author:"",author_info:"",news_time:"",news_detail:"",is_top:0,is_hot:0,title_img:"",enable_state:1},titleImgList:[],rules:{title:[{required:!0,message:"标题不能为空",trigger:"blur"}],author:[{required:!0,message:"作者不能为空",trigger:"blur"}],news_time:[{required:!0,message:"日期不能为空",trigger:"blur"}]},isClick:!1}),i=p({placeholder:"请输入文章内容...",readOnly:!1}),r=p(!1),n=p(null),_=p(null),v=p(null);g((()=>{o.formData.id&&(o.titleImgList=JSON.parse(o.formData.title_img_list))}));const w=p(null);f((()=>{w.value&&F()}),{flush:"post"}),b((()=>{}));const y=h(o);return O=s({close:()=>{l.emit("close",!1)},checkTitleImg:e=>{o.titleImgList.forEach((e=>{e.checked=0})),o.titleImgList[e].checked=1,o.formData.title_img=o.titleImgList[e].imgUrl},quill:v,formRef:_,commitForm:()=>{_.value.validate().then((()=>{v.value.getContents()?o.formData.title_img?(o.formData.news_detail=v.value.getContents(),n.value=v.value.getContents(),o.formData.title_img_list=JSON.stringify(o.titleImgList),r.value=!0,o.formData.id?U(o.formData).then((e=>{m.success("提交成功"),l.emit("saveSuccess")})).catch((e=>{m.error("提交失败")})).finally((()=>{r.value=!1})):q(o.formData).then((e=>{m.success("提交成功"),l.emit("saveSuccess")})).catch((e=>{m.error("提交失败")})).finally((()=>{r.value=!1}))):m.info("请上传图片作为标题图片"):m.info("文章详情不能为空")})).catch((e=>{}))}},y),a(O,t({root:w,onEditorReady:e=>{e.enable(!0),e.clipboard.addMatcher(Node.ELEMENT_NODE,R)},globalOptions:i,changeMessage:async e=>{n.value=e,e.enable(!1),await V(),e.blur(),e.enable(!0)},message:n}));var O}},T={class:"g-flex-start",style:{"flex-wrap":"wrap"}},Y=["onClick"],Q=["src"],B={ref:"root",class:"rootclip"},A={class:"dialog-footer"};J.render=function(e,a,t,l,o,i){const r=_("el-input"),s=_("el-form-item"),n=_("el-date-picker"),u=_("el-switch"),d=_("QuillEditor"),m=_("el-form"),c=_("el-button"),p=_("el-dialog");return v(),w("div",null,[y(p,{"model-value":t.dialogVisible,"before-close":l.close},{footer:O((()=>[D("span",A,[y(c,{onClick:l.close,size:"small"},{default:O((()=>[j("取 消")])),_:1},8,["onClick"]),y(c,{type:"primary",onClick:l.commitForm,size:"small"},{default:O((()=>[j("确 定")])),_:1},8,["onClick"])])])),default:O((()=>[y(m,{"label-width":"100px",model:e.formData,rules:e.rules,ref:"formRef"},{default:O((()=>[y(s,{label:"标题",prop:"title"},{default:O((()=>[y(r,{style:{width:"400px"},size:"mini",modelValue:e.formData.title,"onUpdate:modelValue":a[0]||(a[0]=a=>e.formData.title=a)},null,8,["modelValue"])])),_:1}),y(s,{label:"作者",prop:"author"},{default:O((()=>[y(r,{style:{width:"400px"},size:"mini",modelValue:e.formData.author,"onUpdate:modelValue":a[1]||(a[1]=a=>e.formData.author=a)},null,8,["modelValue"])])),_:1}),y(s,{label:"作者介绍",prop:"author_info"},{default:O((()=>[y(r,{type:"textarea",style:{width:"400px"},size:"mini",modelValue:e.formData.author_info,"onUpdate:modelValue":a[2]||(a[2]=a=>e.formData.author_info=a)},null,8,["modelValue"])])),_:1}),y(s,{label:"日期",prop:"news_time"},{default:O((()=>[y(n,{style:{width:"400px"},size:"mini",modelValue:e.formData.news_time,"onUpdate:modelValue":a[3]||(a[3]=a=>e.formData.news_time=a),type:"date",placeholder:"选择日期","value-format":"YYYY-MM-DD"},null,8,["modelValue"])])),_:1}),y(s,{prop:"enable_state",label:"启用状态:"},{default:O((()=>[y(u,{modelValue:e.formData.enable_state,"onUpdate:modelValue":a[4]||(a[4]=a=>e.formData.enable_state=a),"active-value":1,"inactive-value":0},null,8,["modelValue"])])),_:1}),y(s,{prop:"is_top",label:"置顶:"},{default:O((()=>[y(u,{modelValue:e.formData.is_top,"onUpdate:modelValue":a[5]||(a[5]=a=>e.formData.is_top=a),"active-value":1,"inactive-value":0},null,8,["modelValue"])])),_:1}),y(s,{prop:"is_hot",label:"标记热门:"},{default:O((()=>[y(u,{modelValue:e.formData.is_hot,"onUpdate:modelValue":a[6]||(a[6]=a=>e.formData.is_hot=a),"active-value":1,"inactive-value":0},null,8,["modelValue"])])),_:1}),y(s,{prop:"title_img",label:"标题图片:"},{default:O((()=>[D("div",T,[(v(!0),w(C,null,k(e.titleImgList,((e,a)=>(v(),w("div",{class:x(["title-img-wrap",e.checked?"checked-img":null]),key:a,onClick:e=>l.checkTitleImg(a)},[D("img",{style:{width:"100%",height:"100%"},src:e.imgUrl,alt:""},null,8,Q)],10,Y)))),128))])])),_:1}),y(s,{"label-width":"0",prop:"news_detail"},{default:O((()=>[D("div",B,[y(d,{ref:"quill",style:{"min-height":"300px"},theme:"snow",contentType:"html",content:e.formData.news_detail,toolbar:e.toolbar,modules:e.modules,globalOptions:l.globalOptions,onReady:a[7]||(a[7]=e=>l.onEditorReady(e))},null,8,["content","toolbar","modules","globalOptions"])],512)])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["model-value","before-close"])])},J.__scopeId="data-v-57c30162";const G={name:"",props:{},components:{EditNews:J},setup(e,a){const t=c({targetObj:null,tableData:[],paginationObj:{total:0,current:1,size:10}}),l=p(!1),o=p(!1),i=()=>{o.value=!0,M(t.paginationObj).then((e=>{t.tableData=e.data.data,t.paginationObj.total=e.data.total})).catch((e=>{m.error(e.msg)})).finally((()=>{o.value=!1}))};g((()=>{i()})),b((()=>{}));const r=h(t);return s({pageSizeChange:e=>{t.paginationObj.size=e,t.paginationObj.current=1,i()},pageCurrentChange:e=>{t.paginationObj.current=e,i()},getList:i,addNews:()=>{t.targetObj=null,l.value=!0},updateNews:e=>{t.targetObj=JSON.parse(JSON.stringify(e)),l.value=!0},deleteItem:e=>{I.confirm("确认删除？").then((()=>{o.value=!0,P(e).then((e=>{m.success("删除成功"),i()})).catch((e=>{m.error("删除失败"),o.value=!1}))}))},saveSuccess:()=>{l.value=!1,i()},loading:o,dialogVisible:l},r)}},H={class:"btn-wrap g-flex-end"},K=["src"],W={class:"footer-wrap g-flex-end"};G.render=function(e,a,t,l,o,i){const r=_("el-button"),s=_("el-empty"),n=_("el-table-column"),u=_("el-table"),d=_("el-pagination"),m=_("EditNews"),c=z("loading");return v(),w("div",null,[D("div",H,[y(r,{size:"small",onClick:l.getList},{default:O((()=>[j("刷 新")])),_:1},8,["onClick"]),y(r,{type:"primary",size:"small",onClick:l.addNews},{default:O((()=>[j("添 加")])),_:1},8,["onClick"])]),D("div",null,[S((v(),L(u,{data:e.tableData,border:"",style:{width:"100%"}},{empty:O((()=>[y(s,{description:"暂无数据"})])),default:O((()=>[y(n,{prop:"title",label:"资讯标题"}),y(n,{prop:"url",label:"标题配图"},{default:O((a=>[e.tableData.length&&a.row.title_img?(v(),w("img",{key:0,style:{"max-width":"120px","max-height":"70px"},src:a.row.title_img,alt:""},null,8,K)):E("",!0)])),_:1}),y(n,{prop:"is_top",label:"是否置顶"},{default:O((e=>[D("div",null,N(e.row.is_top?"是":"否"),1)])),_:1}),y(n,{prop:"is_hot",label:"标记热门"},{default:O((e=>[D("div",null,N(e.row.is_hot?"是":"否"),1)])),_:1}),y(n,{prop:"enable_state",label:"启用状态"},{default:O((e=>[D("div",null,N(e.row.enable_state?"启用":"停用"),1)])),_:1}),y(n,{label:"操作"},{default:O((e=>[y(r,{type:"text",onClick:a=>l.updateNews(e.row)},{default:O((()=>[j("修 改")])),_:2},1032,["onClick"]),y(r,{type:"text",onClick:a=>l.deleteItem(e.row.id)},{default:O((()=>[j("删 除")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])),[[c,l.loading]]),D("div",W,[y(d,{layout:"total, prev, pager, next",total:e.paginationObj.total,"current-page":e.paginationObj.current,"page-size":e.paginationObj.size,onSizeChange:l.pageSizeChange,onCurrentChange:l.pageCurrentChange},null,8,["total","current-page","page-size","onSizeChange","onCurrentChange"])])]),l.dialogVisible?(v(),L(m,{key:0,dialogVisible:l.dialogVisible,formObj:e.targetObj,onClose:a[0]||(a[0]=e=>l.dialogVisible=!1),onSaveSuccess:l.saveSuccess},null,8,["dialogVisible","formObj","onSaveSuccess"])):E("",!0)])},G.__scopeId="data-v-e19f7f86";export{G as default};
