var e=Object.defineProperty,a=Object.defineProperties,l=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,r=(a,l,t)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[l]=t;import{E as i,u,A as n,b as c,r as d,M as p,o as m,c as f,w as v,h as g,m as b,p as _,v as h,g as y,W as w,_ as k,e as C,l as O,q as x}from"./vendor.7a5fefe5.js";import{g as z,d as j}from"./index.6a4d3bb4.js";let S="/api/officialWebsite";const D=e=>i({url:S+"/addSoftResult",method:"post",data:e}),P=e=>i({url:S+"/updateSoftResult",method:"post",data:e});const R=["src"],V={key:1,class:"el-icon-plus avatar-uploader-icon"},B={class:"dialog-footer"},E={__name:"editSoftResult",props:{nowData:{type:Object,default:{}},dialogVisible:Boolean},emits:["close"],setup(e,{emit:a}){const l=e,t=u(),s=n(z({name:"token"})),o=n(!1),r=n(null),i=l.nowData.id?c(j(l.nowData)):c({desc:"",image_url:"",type:3,device:2}),C=()=>{r.value.validate().then((()=>{o.value=!0;(i.id?P:D)(i).then((e=>{k.success("提交成功"),o.value=!1,E("success")})).catch((()=>{k.error("提交失败"),o.value=!1}))})).catch((()=>{}))},O=(e,a)=>{i.image_url=e.data.url,k.success("上传成功！")},x=(e,a,l)=>{if(e.message&&401==JSON.parse(e.message).code)return k.warning("登录已过期，请重新登录"),void t.push("/login");k.error("上传失败")},S=()=>{E("")},E=e=>{a("close",e)};return(a,l)=>{const t=d("el-upload"),u=d("el-form-item"),n=d("el-form"),c=d("el-button"),k=d("el-dialog"),z=p("loading");return m(),f(k,{title:w(i).id?"修改软著成果":"添加软著成果","model-value":e.dialogVisible,onClose:S,"close-on-click-modal":!1,"close-on-press-escape":!1},{footer:v((()=>[g("span",B,[b(c,{onClick:l[0]||(l[0]=e=>E("")),size:"small"},{default:v((()=>[_("取 消")])),_:1}),b(c,{type:"primary",onClick:C,size:"small"},{default:v((()=>[_("确 定")])),_:1})])])),default:v((()=>[h((m(),y("div",null,[b(n,{ref_key:"formRef",ref:r,model:w(i)},{default:v((()=>[b(u,{label:"图片:",prop:"image_url",rules:[{required:!0,message:"选择图片"}]},{default:v((()=>[b(t,{class:"avatar-uploader",action:"/api/base/upload/","show-file-list":!1,"on-success":O,"on-error":x,limit:1,headers:{token:s.value,path:"/public/web_image/"}},{default:v((()=>[w(i).image_url?(m(),y("img",{key:0,style:{width:"100%",height:"100%"},src:w(i).image_url,class:"avatar"},null,8,R)):(m(),y("i",V))])),_:1},8,["headers"])])),_:1})])),_:1},8,["model"])])),[[z,o.value]])])),_:1},8,["title","model-value"])}},__scopeId:"data-v-b0b689ac"};const I={class:"btn-wrap g-flex-end"},q={class:"footer-wrap g-flex-end"},M={__name:"index",setup(e){const u=n(!1),w=n([]),z=c({total:0,size:10,current:1}),j=n(!1),D=n({});C((()=>{P()}));const P=()=>{u.value=!0;const e=(n=((e,a)=>{for(var l in a||(a={}))s.call(a,l)&&r(e,l,a[l]);if(t)for(var l of t(a))o.call(a,l)&&r(e,l,a[l]);return e})({},z),a(n,l({type:3})));var n,c;(c=e,i({url:S+"/softResultList",method:"get",params:c})).then((e=>{w.value=e.data.data,z.total=e.data.total})).catch((e=>{k.error(e.msg)})).finally((()=>{u.value=!1}))},R=()=>{D.value={},j.value=!0},V=e=>{x.confirm("确认删除？","",{confirmButtonText:"确定",cancelButtonText:"取消",closeOnClickModal:!1,closeOnPressEscape:!1}).then((()=>{u.value=!0,(e=>i({url:S+"/deleteSoftResult",method:"post",data:{id:e}}))(e).then((e=>{k.success("删除成功"),P()})).catch((e=>{k.error("删除失败"),u.value=!1}))}))},B=e=>{j.value=!1,"success"===e&&P()},M=e=>{z.size=e,z.current=1,P()},T=e=>{z.current=e,P()};return(e,a)=>{const l=d("el-button"),t=d("el-empty"),s=d("el-image"),o=d("el-table-column"),r=d("el-table"),i=d("el-pagination"),n=p("loading");return m(),y("div",null,[g("div",I,[b(l,{size:"small",onClick:P},{default:v((()=>[_("刷 新")])),_:1}),b(l,{type:"primary",size:"small",onClick:R},{default:v((()=>[_("添 加")])),_:1})]),h((m(),f(r,{data:w.value,border:"",style:{width:"100%"}},{empty:v((()=>[b(t,{description:"暂无数据"})])),default:v((()=>[b(o,{prop:"image_url",label:"图片"},{default:v((e=>[b(s,{style:{width:"200px",height:"270px"},src:e.row.image_url,"preview-src-list":[e.row.image_url],fit:"cover"},null,8,["src","preview-src-list"])])),_:1}),b(o,{label:"操作"},{default:v((e=>[b(l,{type:"text",onClick:a=>{return l=e.row,D.value=l,void(j.value=!0);var l}},{default:v((()=>[_("修 改")])),_:2},1032,["onClick"]),b(l,{type:"text",onClick:a=>V(e.row.id)},{default:v((()=>[_("删 除")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])),[[n,u.value]]),g("div",q,[b(i,{layout:"prev, pager, next",total:z.total,"current-page":z.current,"page-size":z.size,onSizeChange:M,onCurrentChange:T},null,8,["total","current-page","page-size"])]),j.value?(m(),f(E,{key:0,nowData:D.value,dialogVisible:j.value,onClose:B},null,8,["nowData","dialogVisible"])):O("",!0)])}},__scopeId:"data-v-0d54219b"};export{M as default};
