var e=Object.defineProperty,a=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,o=(a,t,l)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):a[t]=l,r=(e,r)=>{for(var i in r||(r={}))t.call(r,i)&&o(e,i,r[i]);if(a)for(var i of a(r))l.call(r,i)&&o(e,i,r[i]);return e};import{b as i,c as n,k as s,e as d}from"./information.10e4104d.js";import{D as u,a as c,y as m,d as p,e as f,t as g,r as b,o as v,f as h,p as y,q as _,g as w,M as k,F as j,h as C,s as O,x as V,_ as D,L as x,w as S,c as z,k as L}from"./vendor.456c50f4.js";import{I as U,u as I}from"./base.8c6305d8.js";/* empty css                       */import{g as E}from"./index.8c27f3b6.js";import"./quill.8d3b73ad.js";const N={name:"EditNews",components:{ElMessage:u},props:{dialogVisible:{type:Boolean,default:!1},formObj:{type:Object}},setup(e,a){const t=c({referList:[],fileList:[],modules:{name:"imageUploader",module:U,options:{upload:function(e){return new Promise(((a,t)=>{I(e).then((e=>{a(e.data.data.url)})).catch((e=>{t(e)}))}))}}},formData:e.formObj||{title:"",keyword:"",refer_list:JSON.stringify([]),release_time:"",card_content:""},rules:{title:[{required:!0,message:"标题不能为空",trigger:"blur"}],release_time:[{required:!0,message:"发布日期不能为空",trigger:"blur"}]}}),l=m(!1),o=m(E({name:"token"})),s=m(null);m(null);p((()=>{t.referList=JSON.parse(t.formData.refer_list)})),f((()=>{}));const d=g(t);return r({token:o,uploadError:(e,a,t)=>{if(e.message&&401==JSON.parse(e.message).code)return u.warning("登录已过期，请重新登录"),void router.push("/login");u.error("上传失败")},handleAvatarSuccess:(e,a)=>{t.formData.card_content=e.data.url,u.success("上传成功！")},beforeUpload:e=>{const{type:a,size:t}=e;return"image/png"!==a&&"image/jpeg"!==a?(u.warning("只能上传png或jpg格式图片！"),!1):!(t>2097152)||(u.warning("图片大小不能超过2M！"),!1)},removeImg:(e,a)=>{t.fileList=[],t.formData.card_content=""},close:()=>{a.emit("close",!1)},formRef:s,commitForm:()=>{s.value.validate().then((()=>{t.formData.refer_list=JSON.stringify(t.referList),l.value=!0,t.formData.id?i(t.formData).then((e=>{u.success("提交成功"),a.emit("saveSuccess")})).catch((e=>{u.error("提交失败")})).finally((()=>{l.value=!1})):n(t.formData).then((e=>{u.success("提交成功"),a.emit("saveSuccess")})).catch((e=>{u.error("提交失败")})).finally((()=>{l.value=!1}))})).catch((()=>{}))},addRefer:()=>{t.referList.push({value1:"",value2:""})}},d)}},J=["src"],M={key:1,class:"el-icon-plus avatar-uploader-icon"},q=(e=>(O("data-v-7102a37d"),e=e(),V(),e))((()=>w("div",{class:"g-tips-text"},"* jpg/png格式；大小限制为2M",-1))),K={style:{width:"400px"}},P={class:"dialog-footer"};N.render=function(e,a,t,l,o,r){const i=b("el-upload"),n=b("el-form-item"),s=b("el-input"),d=b("el-button"),u=b("el-date-picker"),c=b("el-form"),m=b("el-dialog");return v(),h("div",null,[y(m,{"model-value":t.dialogVisible,"before-close":l.close},{footer:_((()=>[w("span",P,[y(d,{onClick:l.close,size:"small"},{default:_((()=>[k("取 消")])),_:1},8,["onClick"]),y(d,{type:"primary",onClick:l.commitForm,size:"small"},{default:_((()=>[k("确 定")])),_:1},8,["onClick"])])])),default:_((()=>[y(c,{model:e.formData,rules:e.rules,"label-width":"120px",ref:"formRef"},{default:_((()=>[y(n,{label:"卡片",prop:"content"},{default:_((()=>[y(i,{class:"avatar-uploader",action:"/api/base/upload/","show-file-list":!1,"on-success":l.handleAvatarSuccess,"before-upload":l.beforeUpload,"on-error":l.uploadError,"on-remove":l.removeImg,"file-list":e.fileList,limit:1,headers:{token:l.token}},{default:_((()=>[e.formData.card_content?(v(),h("img",{key:0,style:{width:"100%",height:"100%"},src:e.formData.card_content,class:"avatar"},null,8,J)):(v(),h("i",M))])),_:1},8,["on-success","before-upload","on-error","on-remove","file-list","headers"]),q])),_:1}),y(n,{label:"标题",prop:"title"},{default:_((()=>[y(s,{style:{width:"400px"},size:"mini",modelValue:e.formData.title,"onUpdate:modelValue":a[0]||(a[0]=a=>e.formData.title=a)},null,8,["modelValue"])])),_:1}),y(n,{label:"关键词"},{default:_((()=>[y(s,{style:{width:"400px"},size:"mini",modelValue:e.formData.keyword,"onUpdate:modelValue":a[1]||(a[1]=a=>e.formData.keyword=a)},null,8,["modelValue"])])),_:1}),y(n,{label:"参考文献"},{default:_((()=>[w("div",K,[(v(!0),h(j,null,C(e.referList,((e,a)=>(v(),h("div",{style:{"margin-top":"8px"},key:a,class:"g-flex-between"},[y(s,{style:{"margin-right":"10px"},size:"mini",modelValue:e.value1,"onUpdate:modelValue":a=>e.value1=a},null,8,["modelValue","onUpdate:modelValue"]),y(s,{size:"mini",modelValue:e.value2,"onUpdate:modelValue":a=>e.value2=a},null,8,["modelValue","onUpdate:modelValue"])])))),128)),y(d,{size:"mini",onClick:l.addRefer},{default:_((()=>[k("添 加")])),_:1},8,["onClick"])])])),_:1}),y(n,{label:"发布日期",prop:"news_time"},{default:_((()=>[y(u,{style:{width:"400px"},size:"mini",modelValue:e.formData.release_time,"onUpdate:modelValue":a[2]||(a[2]=a=>e.formData.release_time=a),type:"date",placeholder:"选择日期","value-format":"YYYY-MM-DD"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["model-value","before-close"])])},N.__scopeId="data-v-7102a37d";const R={name:"",props:{},components:{EditKnowge:N},setup(e,a){const t=c({tableData:[],paginationObj:{current:1,size:10,total:0},targetObj:null}),l=m(!1),o=m(!1),i=()=>{l.value=!0,s(t.paginationObj).then((e=>{t.tableData=e.data.data,t.paginationObj.total=e.data.total})).catch((e=>{u.error(e.msg)})).finally((()=>{l.value=!1}))};p((()=>{i()})),f((()=>{}));const n=g(t);return r({loading:l,dialogVisible:o,getList:i,addKnowge:()=>{t.targetObj=null,o.value=!0},updateItem:e=>{t.targetObj=JSON.parse(JSON.stringify(e)),o.value=!0},deleteItem:e=>{D.confirm("确认删除？").then((()=>{l.value=!0,d(e).then((e=>{u.success("删除成功"),i()})).catch((e=>{u.error("删除失败"),l.value=!1}))})).catch((()=>{}))},saveSuccess:()=>{o.value=!1,i()},pageSizeChange:e=>{t.paginationObj.size=e,t.paginationObj.current=1,i()},pageCurrentChange:e=>{t.paginationObj.current=e,i()}},n)}},Y={class:"btn-wrap g-flex-end"},F=["src"],A={class:"footer-wrap g-flex-end"};R.render=function(e,a,t,l,o,r){const i=b("el-button"),n=b("el-empty"),s=b("el-table-column"),d=b("el-table"),u=b("el-pagination"),c=b("EditKnowge"),m=x("loading");return v(),h("div",null,[w("div",Y,[y(i,{size:"small",onClick:l.getList},{default:_((()=>[k("刷 新")])),_:1},8,["onClick"]),y(i,{type:"primary",size:"small",onClick:l.addKnowge},{default:_((()=>[k("添 加")])),_:1},8,["onClick"])]),w("div",null,[S((v(),z(d,{data:e.tableData,border:"",style:{width:"100%"}},{empty:_((()=>[y(n,{description:"暂无数据"})])),default:_((()=>[y(s,{prop:"card_content",label:"知识卡片"},{default:_((a=>[e.tableData.length&&a.row.card_content?(v(),h("img",{key:0,style:{"max-width":"120px","max-height":"70px"},src:a.row.card_content,alt:""},null,8,F)):L("",!0)])),_:1}),y(s,{prop:"keyword",label:"关键词"}),y(s,{prop:"read_num",label:"浏览次数"}),y(s,{prop:"point_num",label:"点赞"}),y(s,{prop:"release_time",label:"发布日期"}),y(s,{label:"操作"},{default:_((a=>[y(i,{type:"text",onClick:t=>e.checkUserComment(a.row.id)},{default:_((()=>[k("评 论")])),_:2},1032,["onClick"]),y(i,{type:"text",onClick:e=>l.updateItem(a.row)},{default:_((()=>[k("修 改")])),_:2},1032,["onClick"]),y(i,{type:"text",onClick:e=>l.deleteItem(a.row.id)},{default:_((()=>[k("删 除")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])),[[m,l.loading]]),w("div",A,[y(u,{layout:"total, prev, pager, next",total:e.paginationObj.total,"current-page":e.paginationObj.current,"page-size":e.paginationObj.size,onSizeChange:l.pageSizeChange,onCurrentChange:l.pageCurrentChange},null,8,["total","current-page","page-size","onSizeChange","onCurrentChange"])])]),l.dialogVisible?(v(),z(c,{key:0,dialogVisible:l.dialogVisible,formObj:e.targetObj,onClose:a[0]||(a[0]=e=>l.dialogVisible=!1),onSaveSuccess:l.saveSuccess},null,8,["dialogVisible","formObj","onSaveSuccess"])):L("",!0)])},R.__scopeId="data-v-c4a47ad6";export{R as default};
