var e=Object.defineProperty,l=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,t=Object.prototype.propertyIsEnumerable,r=(l,a,t)=>a in l?e(l,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[a]=t;import{g as o}from"./index.425550fe.js";import{E as s,u as i,A as n,b as u,r as d,M as c,o as p,c as m,w as b,h as _,m as f,p as v,v as g,g as h,W as w,y,z as k,_ as x,e as V,l as z,k as C,q as j}from"./vendor.7a5fefe5.js";let B="/api/officialWebsite";const O=e=>s({url:B+"/addBanner",method:"post",data:e}),E=e=>s({url:B+"/updateBanner",method:"post",data:e});const U=e=>(y("data-v-12b0c43c"),e=e(),k(),e),P=["src"],M={key:1,class:"el-icon-plus avatar-uploader-icon"},q=U((()=>_("div",{class:"g-tips-text"}," * jpg/png格式；大小限制为4M；宽高比1920:650 ",-1))),I=["src"],L={key:1,class:"el-icon-plus avatar-uploader-icon"},R=U((()=>_("div",{class:"g-tips-text"}," * jpg/png格式；大小限制为2M；宽高比750:375 ",-1))),S={class:"dialog-footer"},T={__name:"editBanner",props:{nowEditBanner:{type:Object,default:{}},dialogVisible:Boolean},emits:["close"],setup(e,{emit:s}){const y=e,k=i(),V=n(!1),z=n(null),C=y.nowEditBanner.id?u(((e,o)=>{for(var s in o||(o={}))a.call(o,s)&&r(e,s,o[s]);if(l)for(var s of l(o))t.call(o,s)&&r(e,s,o[s]);return e})({},y.nowEditBanner)):u({title:"",pc_url:"",mobile_url:"",enable_state:"1",banner_order:1}),j=u({title:[{required:!0,message:"请填写标题"}],pc_url:[{required:!0,message:"请上传图片"}],mobile_url:[{required:!0,message:"请上传图片"}]}),B=n(o({name:"token"})),U=()=>{z.value.validate().then((()=>{V.value=!0;(C.id?E:O)(C).then((e=>{x.success("提交成功"),V.value=!1,W("success")})).catch((()=>{x.error("提交失败"),V.value=!1}))})).catch((()=>{}))},T=()=>{W("")},W=e=>{s("close",e)},A=(e,l,a)=>{"pc"===a?C.pc_url=e.data.url:C.mobile_url=e.data.url,x.success("上传成功！")},J=(e,l)=>{const{type:a,size:t}=e;if("image/png"!==a&&"image/jpeg"!==a)return x.warning("只能上传png或jpg格式图片！"),!1;const r="pc"===l?4:2;if(t>1048576*r)return x.warning(`图片大小不能超过${r}M！`),!1;return new Promise(((a,t)=>{let r=window.URL||window.webkitURL,o=new Image;o.onload=()=>{const e=o.width/o.height;"pc"===l?e>2.7&&e<3.2?a():(x.warning("图片宽高比在1920:650左右!"),t()):e>1.8&&e<2.11?a():(x.warning("图片宽高比在750:375左右!"),t())},o.src=r.createObjectURL(e)})).then((l=>e)).catch((e=>Promise.reject()))},N=(e,l,a)=>{if(e.message&&401==JSON.parse(e.message).code)return x.warning("登录已过期，请重新登录"),void k.push("/login");x.error("上传失败")};return(l,a)=>{const t=d("el-input"),r=d("el-form-item"),o=d("el-upload"),s=d("el-switch"),i=d("el-form"),n=d("el-button"),u=d("el-dialog"),y=c("loading");return p(),m(u,{title:w(C).id?"修改banner":"添加banner","model-value":e.dialogVisible,onClose:T,"close-on-click-modal":!1,"close-on-press-escape":!1},{footer:b((()=>[_("span",S,[f(n,{onClick:a[5]||(a[5]=e=>W("")),size:"small"},{default:b((()=>[v("取 消")])),_:1}),f(n,{type:"primary",onClick:U,size:"small"},{default:b((()=>[v("确 定")])),_:1})])])),default:b((()=>[g((p(),h("div",null,[f(i,{ref_key:"formRef",ref:z,model:w(C),rules:j,"label-width":"120px"},{default:b((()=>[f(r,{prop:"title",label:"标题:"},{default:b((()=>[f(t,{type:"text",size:"mini",modelValue:w(C).title,"onUpdate:modelValue":a[0]||(a[0]=e=>w(C).title=e),placeholder:"输入标题"},null,8,["modelValue"])])),_:1}),f(r,{label:"pc端图片:",prop:"pc_url"},{default:b((()=>[f(o,{class:"avatar-uploader-pc",action:"/api/base/upload/","show-file-list":!1,"on-success":(e,l)=>{A(e,0,"pc")},"before-upload":e=>J(e,"pc"),"on-error":N,limit:1,headers:{token:B.value,path:"/public/web_image/"}},{default:b((()=>[w(C).pc_url?(p(),h("img",{key:0,style:{width:"100%",height:"100%"},src:w(C).pc_url,class:"avatar"},null,8,P)):(p(),h("i",M))])),_:1},8,["on-success","before-upload","headers"]),q])),_:1}),f(r,{prop:"pc_url",label:"pc端图片地址:"},{default:b((()=>[f(t,{size:"mini",disabled:!1,modelValue:w(C).pc_url,"onUpdate:modelValue":a[1]||(a[1]=e=>w(C).pc_url=e)},null,8,["modelValue"])])),_:1}),f(r,{label:"移动端端图片:",prop:"mobile_url"},{default:b((()=>[f(o,{class:"avatar-uploader-mobile",action:"/api/base/upload/","show-file-list":!1,"on-success":A,"before-upload":J,"on-error":N,limit:1,headers:{token:B.value,path:"/public/web_image/"}},{default:b((()=>[w(C).mobile_url?(p(),h("img",{key:0,style:{width:"100%",height:"100%"},src:w(C).mobile_url,class:"avatar"},null,8,I)):(p(),h("i",L))])),_:1},8,["headers"]),R])),_:1}),f(r,{prop:"mobile_url",label:"移动端图片地址:"},{default:b((()=>[f(t,{size:"mini",disabled:!0,modelValue:w(C).mobile_url,"onUpdate:modelValue":a[2]||(a[2]=e=>w(C).mobile_url=e)},null,8,["modelValue"])])),_:1}),f(r,{prop:"banner_order",label:"排序:"},{default:b((()=>[f(t,{type:"number",size:"mini",modelValue:w(C).banner_order,"onUpdate:modelValue":a[3]||(a[3]=e=>w(C).banner_order=e),placeholder:"输入顺序"},null,8,["modelValue"])])),_:1}),f(r,{prop:"enable_state",label:"启用状态:"},{default:b((()=>[f(s,{modelValue:w(C).enable_state,"onUpdate:modelValue":a[4]||(a[4]=e=>w(C).enable_state=e),"active-value":1,"inactive-value":0},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),[[y,V.value]])])),_:1},8,["title","model-value"])}},__scopeId:"data-v-12b0c43c"};const W={class:"btn-wrap g-flex-end"},A={class:"footer-wrap g-flex-end"},J={__name:"index",setup(e){const l=n(!1);let a=n([]);const t=u({total:0,size:10,current:1});let r=n({});const o=n(!1),i=()=>{var e;l.value=!0,(e=t,s({url:B+"/bannerList",method:"get",params:e})).then((e=>{a.value=e.data.data,t.total=e.data.total})).catch((e=>{x.error(e.msg)})).finally((()=>{l.value=!1}))};V((()=>{i()}));const y=()=>{r.value={},o.value=!0},k=e=>{o.value=!1,"success"===e&&i()},O=e=>{j.confirm("确认删除？","",{confirmButtonText:"确定",cancelButtonText:"取消",closeOnClickModal:!1,closeOnPressEscape:!1}).then((()=>{l.value=!0,(e=>s({url:B+"/deleteBanner",method:"post",data:{id:e}}))(e).then((e=>{x.success("删除成功"),i()})).catch((e=>{x.error("删除失败"),l.value=!1}))}))},E=e=>{t.size=e,t.current=1,i()},U=e=>{t.current=e,i()};return(e,s)=>{const n=d("el-button"),u=d("el-empty"),x=d("el-table-column"),V=d("el-image"),j=d("el-table"),B=d("el-pagination"),P=c("loading");return p(),h("div",null,[_("div",W,[f(n,{size:"small",onClick:i},{default:b((()=>[v("刷 新")])),_:1}),f(n,{type:"primary",size:"small",onClick:y},{default:b((()=>[v("添 加")])),_:1})]),g((p(),m(j,{data:w(a),border:"",style:{width:"100%"}},{empty:b((()=>[f(u,{description:"暂无数据"})])),default:b((()=>[f(x,{prop:"title",label:"标题"}),f(x,{prop:"pc_url",label:"PC缩略图",width:"270px"},{default:b((e=>[f(V,{style:{width:"248px",height:"84px"},src:e.row.pc_url,"preview-src-list":[e.row.pc_url],fit:"cover"},null,8,["src","preview-src-list"])])),_:1}),f(x,{prop:"mobile_url",label:"mobile缩略图",width:"188px"},{default:b((e=>[f(V,{style:{width:"168px",height:"84px"},src:e.row.mobile_url,"preview-src-list":[e.row.mobile_url],fit:"cover"},null,8,["src","preview-src-list"])])),_:1}),f(x,{prop:"enable_state",label:"启用状态"},{default:b((e=>[_("div",null,C(e.row.enable_state?"启用":"停用"),1)])),_:1}),f(x,{prop:"banner_order",label:"排序"}),f(x,{label:"操作"},{default:b((e=>[f(n,{type:"text",onClick:l=>{return a=e.row,r.value=a,void(o.value=!0);var a}},{default:b((()=>[v("修 改")])),_:2},1032,["onClick"]),f(n,{type:"text",onClick:l=>O(e.row.id)},{default:b((()=>[v("删 除")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])),[[P,l.value]]),_("div",A,[f(B,{layout:"prev, pager, next",total:t.total,"current-page":t.current,"page-size":t.size,onSizeChange:E,onCurrentChange:U},null,8,["total","current-page","page-size"])]),o.value?(p(),m(T,{key:0,nowEditBanner:w(r),dialogVisible:o.value,onClose:k},null,8,["nowEditBanner","dialogVisible"])):z("",!0)])}},__scopeId:"data-v-53d64ffe"};export{J as default};
