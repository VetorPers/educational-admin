var e=Object.defineProperty,a=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,t=Object.prototype.propertyIsEnumerable,o=(a,l,t)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[l]=t,i=(e,i)=>{for(var r in i||(i={}))l.call(i,r)&&o(e,r,i[r]);if(a)for(var r of a(i))t.call(i,r)&&o(e,r,i[r]);return e};import{u as r,a as s,g as n,d as u}from"./goods.f7ad5d9f.js";import{D as d,m as p,u as m,y as c,b as f,a as b,d as g,e as _,t as v,r as y,L as h,o as V,c as D,q as j,g as O,p as k,M as I,w as C,f as w,s as z,x as S,_ as x,k as U,j as L}from"./vendor.456c50f4.js";import{g as E}from"./index.8c27f3b6.js";const G={name:"",props:{dialogVisible:{type:Boolean,required:!0,defalut:!1},formObj:{type:Object}},components:{ElMessage:d},emits:["close","saveSuccess"],setup(e,a){const l=p(),t=m(),o=c(!1),n=f((()=>t.state.init.phoneAppRouter)),u=b({formData:e.formObj||{main_img:"",name:"",count:"",integral_price:"",goods_order:1,type:0,limit_type:1,enable_status:1,detail_img:""},fileList:[],detailImgList:[],rules:{url:[{required:!0,message:"图片地址不能为空"}],banner_order:[{required:!0,message:"排序不能为空",trigger:"blur"}]}}),y=c(E({name:"token"})),h=c(null);g((()=>{var a;(null==(a=e.formObj)?void 0:a.detail_img)&&(u.detailImgList=JSON.parse(e.formObj.detail_img))})),_((()=>{}));const V=v(u);return i({appRouteList:n,formRef:h,commitForm:()=>{h.value.validate().then((()=>{o.value=!0,u.detailImgList.length&&(u.formData.detail_img=JSON.stringify(u.detailImgList)),u.formData.id?r(u.formData).then((e=>{d.success("提交成功"),a.emit("saveSuccess")})).catch((e=>{d.error("提交失败")})).finally((()=>{o.value=!1})):s(u.formData).then((e=>{d.success("提交成功"),a.emit("saveSuccess")})).catch((e=>{d.error("提交失败")})).finally((()=>{o.value=!1}))})).catch((()=>{}))},beforeUpload:e=>{const{type:a,size:l}=e;return"image/png"!==a&&"image/jpeg"!==a?(d.warning("只能上传png或jpg格式图片！"),!1):!(l>2097152)||(d.warning("图片大小不能超过2M！"),!1)},removeImg:(e,a)=>{u.fileList=[],u.formData.url=""},close:()=>{a.emit("close",!1)},loading:o,uploadError:(e,a,t)=>{if(e.message&&401==JSON.parse(e.message).code)return d.warning("登录已过期，请重新登录"),void l.push("/login");d.error("上传失败")},token:y,handleAvatarSuccess:(e,a)=>{u.formData.main_img=e.data.url,d.success("上传成功！")},detailImgSuccess:(e,a,l)=>{u.detailImgList.push({name:a.name,url:e.data.url})},removeDetailImg:(e,a)=>{this.detailImgList=a}},V)}},M=e=>(z("data-v-88a090a0"),e=e(),S(),e),R=["src"],J={key:1,class:"el-icon-plus avatar-uploader-icon"},N=M((()=>O("div",{class:"g-tips-text"},"* jpg/png格式；大小限制为2M",-1))),q=M((()=>O("div",{class:"el-upload__tip"}," jpg/png格式；大小限制为2M；至多上传3张； ",-1))),A={class:"dialog-footer"};G.render=function(e,a,l,t,o,i){const r=y("el-upload"),s=y("el-form-item"),n=y("el-input"),u=y("el-col"),d=y("el-option"),p=y("el-select"),m=y("el-switch"),c=y("el-row"),f=y("el-button"),b=y("el-form"),g=y("el-dialog"),_=h("loading");return V(),D(g,{title:e.formData.id?"修改商品":"添加商品","model-value":l.dialogVisible,"before-close":t.close},{footer:j((()=>[O("span",A,[k(f,{onClick:t.close,size:"small"},{default:j((()=>[I("取 消")])),_:1},8,["onClick"]),k(f,{type:"primary",onClick:t.commitForm,size:"small"},{default:j((()=>[I("确 定")])),_:1},8,["onClick"])])])),default:j((()=>[C((V(),w("div",null,[k(b,{ref:"formRef",model:e.formData,rules:e.rules,"label-width":"120px"},{default:j((()=>[k(s,{label:"上传主图:"},{default:j((()=>[k(r,{class:"avatar-uploader",action:"/api/base/upload/","show-file-list":!1,"on-success":t.handleAvatarSuccess,"before-upload":t.beforeUpload,"on-error":t.uploadError,"on-remove":t.removeImg,"file-list":e.fileList,limit:1,headers:{token:t.token}},{default:j((()=>[e.formData.main_img?(V(),w("img",{key:0,style:{width:"100%",height:"100%"},src:e.formData.main_img,class:"avatar"},null,8,R)):(V(),w("i",J))])),_:1},8,["on-success","before-upload","on-error","on-remove","file-list","headers"]),N])),_:1}),k(s,{prop:"main_img",label:"主图地址:"},{default:j((()=>[k(n,{size:"mini",disabled:!0,modelValue:e.formData.main_img,"onUpdate:modelValue":a[0]||(a[0]=a=>e.formData.main_img=a)},null,8,["modelValue"])])),_:1}),k(c,null,{default:j((()=>[k(u,{span:12},{default:j((()=>[k(s,{prop:"name",label:"商品名称:"},{default:j((()=>[k(n,{size:"mini",modelValue:e.formData.name,"onUpdate:modelValue":a[1]||(a[1]=a=>e.formData.name=a)},null,8,["modelValue"])])),_:1})])),_:1}),k(u,{span:12},{default:j((()=>[k(s,{prop:"count",label:"商品数量:"},{default:j((()=>[k(n,{size:"mini",type:"number",modelValue:e.formData.count,"onUpdate:modelValue":a[2]||(a[2]=a=>e.formData.count=a)},null,8,["modelValue"])])),_:1})])),_:1}),k(u,{span:12},{default:j((()=>[k(s,{prop:"integral_price",label:"消耗积分:"},{default:j((()=>[k(n,{size:"mini",type:"number",modelValue:e.formData.integral_price,"onUpdate:modelValue":a[3]||(a[3]=a=>e.formData.integral_price=a)},null,8,["modelValue"])])),_:1})])),_:1}),k(u,{span:12},{default:j((()=>[k(s,{prop:"goods_order",label:"排序:"},{default:j((()=>[k(n,{type:"number",size:"mini",modelValue:e.formData.goods_order,"onUpdate:modelValue":a[4]||(a[4]=a=>e.formData.goods_order=a),placeholder:"输入顺序"},null,8,["modelValue"])])),_:1})])),_:1}),k(u,{span:12},{default:j((()=>[k(s,{prop:"type",label:"商品类型:"},{default:j((()=>[k(p,{size:"mini",placeholder:"选择类型",modelValue:e.formData.type,"onUpdate:modelValue":a[5]||(a[5]=a=>e.formData.type=a)},{default:j((()=>[k(d,{label:"虚拟商品",value:0}),k(d,{label:"实物商品",value:1})])),_:1},8,["modelValue"])])),_:1})])),_:1}),k(u,{span:12},{default:j((()=>[k(s,{prop:"limit_type",label:"兑换限制:"},{default:j((()=>[k(p,{size:"mini",placeholder:"选择条件",modelValue:e.formData.limit_type,"onUpdate:modelValue":a[6]||(a[6]=a=>e.formData.limit_type=a)},{default:j((()=>[k(d,{label:"无限制",value:0}),k(d,{label:"每月可兑换一次（智铸超云）",value:1}),k(d,{label:"每年兑换一次（小程序）",value:2}),k(d,{label:"每个id兑换一次",value:3}),k(d,{label:"每月可兑换3次（智铸超云）",value:4})])),_:1},8,["modelValue"])])),_:1})])),_:1}),k(u,{span:12},{default:j((()=>[k(s,{prop:"enable_state",label:"启用状态:"},{default:j((()=>[k(m,{modelValue:e.formData.enable_status,"onUpdate:modelValue":a[7]||(a[7]=a=>e.formData.enable_status=a),"active-value":1,"inactive-value":0},null,8,["modelValue"])])),_:1})])),_:1})])),_:1}),k(s,{label:"上传详情图片:"},{default:j((()=>[k(r,{class:"upload-demo",action:"/api/base/upload/","list-type":"picture","on-success":t.detailImgSuccess,"before-upload":t.beforeUpload,"on-remove":t.removeDetailImg,"on-error":t.uploadError,limit:3,"file-list":e.detailImgList,headers:{token:t.token}},{tip:j((()=>[q])),default:j((()=>[k(f,{type:"primary"},{default:j((()=>[I("点击上传")])),_:1})])),_:1},8,["on-success","before-upload","on-remove","on-error","file-list","headers"])])),_:1})])),_:1},8,["model","rules"])])),[[_,t.loading]])])),_:1},8,["title","model-value","before-close"])},G.__scopeId="data-v-88a090a0";const P={name:"bannerIndex",props:{},components:{EditGoods:G,ElMessage:d},setup(e,a){const l=b({targetObj:null,tableData:[],paginationObj:{current:1,size:10,total:0},searchInfo:{name:"",enable_status:"",type:"",limit_type:""}}),t=m(),o=f((()=>t.state.init.phoneAppRouter)),r=c(!1),s=c(!1);function p(e){s.value=e}const y=()=>{r.value=!0;let e=Object.assign(l.searchInfo,l.paginationObj);n(e).then((e=>{l.tableData=e.data.data,l.tableData.forEach((e=>{switch(e.limit_type){case 0:e.limit_type_label="无限制";break;case 1:e.limit_type_label="每月可兑换一次（智铸超云）";break;case 2:e.limit_type_label="每年兑换一次（小程序）";break;case 3:e.limit_type_label="每个id兑换一次";break;case 4:e.limit_type_label="每月可兑换3次（智铸超云）";break;default:e.limit_type_label=""}e.surplus_num=e.count-e.sale_num,e.sum_value=e.count*e.integral_price})),l.paginationObj.total=e.data.total})).catch((e=>{d.error(e.msg)})).finally((()=>{r.value=!1}))};g((()=>{y()})),_((()=>{}));const h=v(l);return i({pageSizeChange:e=>{l.paginationObj.size=e,l.paginationObj.current=1,y()},pageCurrentChange:e=>{l.paginationObj.current=e,y()},changeDiaStatus:p,getList:y,saveSuccess:()=>{s.value=!1,y()},addGoods:()=>{l.targetObj=null,p(!0)},updateGoods:e=>{l.targetObj=JSON.parse(JSON.stringify(e)),p(!0)},deleteItem:e=>{x.confirm("确认删除？").then((()=>{r.value=!0,u(e).then((e=>{d.success("删除成功"),y()})).catch((e=>{d.error("删除失败"),r.value=!1}))}))},search:()=>{l.paginationObj.current=1,y()},appRouteList:o,loading:r,dialogVisible:s},h)}},F={class:"btn-wrap g-flex-between"},B={class:"g-flex-start"},H=(e=>(z("data-v-1c38072a"),e=e(),S(),e))((()=>O("div",{style:{width:"100px"}},"商品名称：",-1))),K=["src"],Q={key:0,style:{color:"#90ee90"}},T={key:1,style:{color:"#ff0000"}},W={class:"footer-wrap g-flex-end"};P.render=function(e,a,l,t,o,i){const r=y("el-option"),s=y("el-select"),n=y("el-input"),u=y("el-button"),d=y("el-space"),p=y("el-empty"),m=y("el-table-column"),c=y("el-table"),f=y("el-pagination"),b=y("EditGoods"),g=h("loading");return V(),w("div",null,[O("div",F,[k(d,null,{default:j((()=>[k(s,{size:"mini",modelValue:e.searchInfo.enable_status,"onUpdate:modelValue":a[0]||(a[0]=a=>e.searchInfo.enable_status=a),placeholder:"启用状态"},{default:j((()=>[k(r,{label:"启用",value:1}),k(r,{label:"停用",value:0})])),_:1},8,["modelValue"]),k(s,{size:"mini",modelValue:e.searchInfo.type,"onUpdate:modelValue":a[1]||(a[1]=a=>e.searchInfo.type=a),placeholder:"商品类型"},{default:j((()=>[k(r,{label:"虚拟商品",value:0}),k(r,{label:"实物商品",value:1})])),_:1},8,["modelValue"]),k(s,{size:"mini",modelValue:e.searchInfo.limit_type,"onUpdate:modelValue":a[2]||(a[2]=a=>e.searchInfo.limit_type=a),placeholder:"限制条件"},{default:j((()=>[k(r,{label:"无限制",value:0}),k(r,{label:"每月可兑换一次（智铸超云）",value:1}),k(r,{label:"每年兑换一次（小程序）",value:2}),k(r,{label:"每个id兑换一次",value:3}),k(r,{label:"每月可兑换3次（智铸超云）",value:4})])),_:1},8,["modelValue"]),O("div",B,[H,k(n,{size:"mini",modelValue:e.searchInfo.name,"onUpdate:modelValue":a[3]||(a[3]=a=>e.searchInfo.name=a)},null,8,["modelValue"])]),k(u,{size:"mini",type:"primary",onClick:t.search},{default:j((()=>[I("查询")])),_:1},8,["onClick"])])),_:1}),k(u,{type:"primary",size:"small",onClick:t.addGoods},{default:j((()=>[I("添 加")])),_:1},8,["onClick"])]),C((V(),D(c,{data:e.tableData,border:"",style:{width:"100%"}},{empty:j((()=>[k(p,{description:"暂无数据"})])),default:j((()=>[k(m,{prop:"name",label:"商品名称"}),k(m,{prop:"main_img",label:"商品主图"},{default:j((a=>[e.tableData.length&&a.row.main_img?(V(),w("img",{key:0,style:{"max-width":"120px","max-height":"70px"},src:a.row.main_img,alt:""},null,8,K)):U("",!0)])),_:1}),k(m,{prop:"type",label:"商品类型"},{default:j((e=>[O("div",null,L(0==e.row.type?"虚拟商品":"实物商品"),1)])),_:1}),k(m,{prop:"limit_type_label",label:"兑换限制"}),k(m,{prop:"integral_price",label:"消耗积分"}),k(m,{prop:"count",label:"总数量"}),k(m,{prop:"sale_num",label:"已兑换数量"}),k(m,{prop:"surplus_num",label:"剩余数量"}),k(m,{prop:"sum_value",label:"总值"}),k(m,{prop:"enable_status",label:"启用状态"},{default:j((e=>[e.row.enable_status?(V(),w("div",Q,"启用")):(V(),w("div",T,"停用"))])),_:1}),k(m,{prop:"goods_order",label:"排序"}),k(m,{prop:"create_time",label:"创建时间"}),k(m,{label:"操作"},{default:j((e=>[k(u,{type:"text",onClick:a=>t.updateGoods(e.row)},{default:j((()=>[I("修 改")])),_:2},1032,["onClick"]),k(u,{type:"text",onClick:a=>t.deleteItem(e.row.id)},{default:j((()=>[I("删 除")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])),[[g,t.loading]]),O("div",W,[k(f,{layout:"prev, pager, next",total:e.paginationObj.total,"current-page":e.paginationObj.current,"page-size":e.paginationObj.size,onSizeChange:t.pageSizeChange,onCurrentChange:t.pageCurrentChange},null,8,["total","current-page","page-size","onSizeChange","onCurrentChange"]),t.dialogVisible?(V(),D(b,{key:0,dialogVisible:t.dialogVisible,formObj:e.targetObj,onClose:t.changeDiaStatus,onSaveSuccess:t.saveSuccess},null,8,["dialogVisible","formObj","onClose","onSaveSuccess"])):U("",!0)])])},P.__scopeId="data-v-1c38072a";export{P as default};
