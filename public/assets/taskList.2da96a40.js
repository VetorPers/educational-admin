var e=Object.defineProperty,a=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,t=Object.prototype.propertyIsEnumerable,o=(a,l,t)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[l]=t,s=(e,s)=>{for(var n in s||(s={}))l.call(s,n)&&o(e,n,s[n]);if(a)for(var n of a(s))t.call(s,n)&&o(e,n,s[n]);return e};import{g as n}from"./index.8c27f3b6.js";import{E as r,D as i,u,m as d,y as p,b as c,a as m,d as f,e as g,t as b,r as h,L as v,o as k,c as _,q as y,g as j,p as D,M as O,w as C,f as V,F as S,h as w,s as z,x,_ as I,k as L,j as E}from"./vendor.456c50f4.js";const R={name:"",props:{dialogVisible:{type:Boolean,required:!0,defalut:!1},formObj:{type:Object}},components:{ElMessage:i},emits:["close","saveSuccess"],setup(e,a){const l=u(),t=d(),o=p(!1),h=c((()=>l.state.init.phoneAppRouter)),v=m({formData:e.formObj||{icon:"",url:"",task_name:"",bonus:10,button_name:"去完成"},fileList:[],rules:{icon:[{required:!0,message:"图标不能为空"}],bonus:[{required:!0,message:"任务积分不能为空",trigger:"blur"}],task_name:[{required:!0,message:"任务标题不能为空",trigger:"blur"}]}}),k=p(n({name:"token"})),_=p(null);f((()=>{})),g((()=>{}));const y=b(v);return s({formRef:_,commitForm:()=>{_.value.validate().then((()=>{o.value=!0,v.formData.id?(e=>r({url:"/api/task/updateTask",method:"post",data:e}))(v.formData).then((e=>{i.success("提交成功"),a.emit("saveSuccess")})).catch((e=>{i.error("提交失败")})).finally((()=>{o.value=!1})):(e=>r({url:"/api/task/addTask",method:"post",data:e}))(v.formData).then((e=>{i.success("提交成功"),a.emit("saveSuccess")})).catch((e=>{i.error("提交失败")})).finally((()=>{o.value=!1}))})).catch((()=>{}))},beforeUpload:e=>{const{type:a,size:l}=e;return"image/png"!==a&&"image/jpeg"!==a?(i.warning("只能上传png或jpg格式图片！"),!1):!(l>2097152)||(i.warning("图片大小不能超过2M！"),!1)},removeImg:(e,a)=>{v.fileList=[],v.formData.icon=""},close:()=>{a.emit("close",!1)},loading:o,uploadError:(e,a,l)=>{if(e.message&&401==JSON.parse(e.message).code)return i.warning("登录已过期，请重新登录"),void t.push("/login");i.error("上传失败")},token:k,handleIconSuccess:(e,a)=>{v.formData.icon=e.data.url,i.success("上传成功！")},appRouteList:h},y)}},T=["src"],U={key:1,class:"el-icon-plus avatar-uploader-icon"},q=(e=>(z("data-v-225c4de8"),e=e(),x(),e))((()=>j("div",{class:"g-tips-text"},"* jpg/png格式",-1))),M={class:"dialog-footer"};R.render=function(e,a,l,t,o,s){const n=h("el-upload"),r=h("el-form-item"),i=h("el-option"),u=h("el-select"),d=h("el-input"),p=h("el-form"),c=h("el-button"),m=h("el-dialog"),f=v("loading");return k(),_(m,{title:e.formData.id?"修改任务":"添加任务","model-value":l.dialogVisible,"before-close":t.close},{footer:y((()=>[j("span",M,[D(c,{onClick:t.close,size:"small"},{default:y((()=>[O("取 消")])),_:1},8,["onClick"]),D(c,{type:"primary",onClick:t.commitForm,size:"small"},{default:y((()=>[O("确 定")])),_:1},8,["onClick"])])])),default:y((()=>[C((k(),V("div",null,[D(p,{ref:"formRef",model:e.formData,rules:e.rules,"label-width":"120px"},{default:y((()=>[D(r,{label:"icon:"},{default:y((()=>[D(n,{class:"avatar-uploader",action:"/api/base/upload/","show-file-list":!1,"on-success":t.handleIconSuccess,"before-upload":t.beforeUpload,"on-error":t.uploadError,"on-remove":t.removeImg,"file-list":e.fileList,limit:1,headers:{token:t.token}},{default:y((()=>[e.formData.icon?(k(),V("img",{key:0,style:{width:"100%",height:"100%"},src:e.formData.icon,class:"avatar"},null,8,T)):(k(),V("i",U))])),_:1},8,["on-success","before-upload","on-error","on-remove","file-list","headers"]),q])),_:1}),D(r,{prop:"url",label:"跳转地址:"},{default:y((()=>[D(u,{size:"mini",placeholder:"选择点击任务跳转的地址",modelValue:e.formData.url,"onUpdate:modelValue":a[0]||(a[0]=a=>e.formData.url=a)},{default:y((()=>[(k(!0),V(S,null,w(t.appRouteList,((e,a)=>(k(),_(i,{key:a,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),D(r,{prop:"icon",label:"icon地址:"},{default:y((()=>[D(d,{size:"mini",disabled:!0,modelValue:e.formData.icon,"onUpdate:modelValue":a[1]||(a[1]=a=>e.formData.icon=a)},null,8,["modelValue"])])),_:1}),D(r,{prop:"task_name",label:"任务标题:"},{default:y((()=>[D(d,{size:"mini",modelValue:e.formData.task_name,"onUpdate:modelValue":a[2]||(a[2]=a=>e.formData.task_name=a),placeholder:"输入任务标题"},null,8,["modelValue"])])),_:1}),D(r,{prop:"bonus",label:"任务积分:"},{default:y((()=>[D(d,{type:"number",size:"mini",modelValue:e.formData.bonus,"onUpdate:modelValue":a[3]||(a[3]=a=>e.formData.bonus=a),placeholder:"输入任务积分"},null,8,["modelValue"])])),_:1}),D(r,{prop:"button_name",label:"按钮名称:"},{default:y((()=>[D(d,{size:"mini",modelValue:e.formData.button_name,"onUpdate:modelValue":a[4]||(a[4]=a=>e.formData.button_name=a),placeholder:"输入按钮名称"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),[[f,t.loading]])])),_:1},8,["title","model-value","before-close"])},R.__scopeId="data-v-225c4de8";const F={name:"task",props:{},components:{EditTask:R,ElMessage:i},setup(e,a){const l=m({targetObj:null,tableData:[],paginationObj:{current:1,size:10,total:0}}),t=u(),o=c((()=>t.state.init.phoneAppRouter)),n=p(!1),d=p(!1);function h(e){d.value=e}const v=()=>{var e;n.value=!0,(e=l.paginationObj,r({url:"/api/task/taskList",method:"get",params:e})).then((e=>{l.tableData=e.data.data,l.paginationObj.total=e.data.total})).catch((e=>{i.error(e.msg)})).finally((()=>{n.value=!1}))};f((()=>{v()})),g((()=>{}));const k=b(l);return s({pageSizeChange:e=>{l.paginationObj.size=e,l.paginationObj.current=1,v()},pageCurrentChange:e=>{l.paginationObj.current=e,v()},changeDiaStatus:h,getList:v,saveSuccess:()=>{d.value=!1,v()},addTask:()=>{l.targetObj=null,h(!0)},updateItem:e=>{l.targetObj=JSON.parse(JSON.stringify(e)),h(!0)},deleteItem:e=>{I.confirm("确认删除？").then((()=>{n.value=!0,(e=>r({url:"/api/task/deleteTask",method:"post",data:{id:e}}))(e).then((e=>{i.success("删除成功"),v()})).catch((e=>{i.error("删除失败"),n.value=!1}))}))},appRouteList:o,loading:n,dialogVisible:d},k)}},J={class:"btn-wrap g-flex-end"},N=["src"],P={class:"footer-wrap g-flex-end"};F.render=function(e,a,l,t,o,s){const n=h("el-button"),r=h("el-empty"),i=h("el-table-column"),u=h("el-table"),d=h("el-pagination"),p=h("EditTask"),c=v("loading");return k(),V("div",null,[j("div",J,[D(n,{size:"small",onClick:t.getList},{default:y((()=>[O("刷 新")])),_:1},8,["onClick"]),D(n,{type:"primary",size:"small",onClick:t.addTask},{default:y((()=>[O("添 加")])),_:1},8,["onClick"])]),C((k(),_(u,{data:e.tableData,border:"",style:{width:"100%"}},{empty:y((()=>[D(r,{description:"暂无数据"})])),default:y((()=>[D(i,{prop:"icon",label:"icon"},{default:y((a=>[e.tableData.length&&a.row.icon?(k(),V("img",{key:0,style:{"max-width":"120px","max-height":"70px"},src:a.row.icon,alt:""},null,8,N)):L("",!0)])),_:1}),D(i,{prop:"task_name",label:"任务名称"}),D(i,{prop:"bonus",label:"任务积分"}),D(i,{prop:"button_name",label:"按钮名称"}),D(i,{prop:"url",label:"跳转页面"},{default:y((e=>[O(E(t.appRouteList.find((a=>a.value==e.row.url)).label),1)])),_:1}),D(i,{label:"操作"},{default:y((e=>[D(n,{type:"text",onClick:a=>t.updateItem(e.row)},{default:y((()=>[O("修 改")])),_:2},1032,["onClick"]),D(n,{type:"text",onClick:a=>t.deleteItem(e.row.id)},{default:y((()=>[O("删 除")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])),[[c,t.loading]]),j("div",P,[D(d,{layout:"total,prev,pager,next",total:e.paginationObj.total,"current-page":e.paginationObj.current,"page-size":e.paginationObj.size,onSizeChange:t.pageSizeChange,onCurrentChange:t.pageCurrentChange},null,8,["total","current-page","page-size","onSizeChange","onCurrentChange"])]),t.dialogVisible?(k(),_(p,{key:0,dialogVisible:t.dialogVisible,formObj:e.targetObj,onClose:t.changeDiaStatus,onSaveSuccess:t.saveSuccess},null,8,["dialogVisible","formObj","onClose","onSaveSuccess"])):L("",!0)])},F.__scopeId="data-v-4f138951";export{F as default};
